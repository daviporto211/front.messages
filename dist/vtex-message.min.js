/* front-messages-ui - v2.0.10 */

(function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}};c="undefined"!=typeof exports&&null!==exports?exports:window,window.vtex=window.vtex||{},a=function(){function a(a){var b,c,e;if(null==a&&(a={}),this.hide=d(this.hide,this),this.show=d(this.show,this),this.classes={TEMPLATEDEFAULT:".vtex-front-messages-template.vtex-front-messages-template-default",MODALTEMPLATEDEFAULT:".vtex-front-messages-modal-template.vtex-front-messages-modal-template-default",TEMPLATE:".vtex-front-messages-template",TITLE:".vtex-front-messages-title",SEPARATOR:".vtex-front-messages-separator",DETAIL:".vtex-front-messages-detail",TYPE:"vtex-front-messages-type-",MESSAGEINSTANCE:"vtex-front-messages-instance"},b={id:_.uniqueId("vtex-front-message-"),timeout:3e4,template:this.classes.TEMPLATE,modalTemplate:this.classes.MODALTEMPLATE,prefixClassForType:this.classes.TYPE,content:{title:"",detail:""},close:"Close",type:"info",usingModal:!1,usingDefaultTemplate:!0,domElement:$(),insertMethod:"append",timer:null},_.extend(this,b,a),"fatal"===this.type&&(this.usingModal=!0),this.timeout=this.getTimeoutDefaults(a),e='<div class="vtex-front-messages-modal-template vtex-front-messages-modal-template-default modal hide fade">\n  <div class="modal-header">\n    <h3 class="vtex-front-messages-title"></h3>\n  </div>\n  <div class="modal-body">\n    <p class="vtex-front-messages-detail"></p>\n  </div>\n  <div class="modal-footer">\n    <button class="btn" data-dismiss="modal" aria-hidden="true">'+this.close+"</button>\n  </div>\n</div>",c='<div class="vtex-front-messages-template">\n  <span class="vtex-front-messages-title"></span><span class="vtex-front-messages-separator"> - </span><span 						class="vtex-front-messages-detail"></span>\n</div>',this.usingModal){if(!$(vtex.Messages.getInstance().modalPlaceholder)[0])throw new Error("Couldn't find placeholder for Modal Message");if(this.modalTemplate===this.classes.MODALTEMPLATE)this.modalTemplate=e,this.usingDefaultTemplate=!0;else{if(!$(this.modalTemplate)[0])throw new Error("Couldn't find specified template for Modal Message");this.usingDefaultTemplate=!1}this.domElement=$(this.modalTemplate),$(this.domElement).addClass(this.id+" "+this.classes.MESSAGEINSTANCE+" "+this.classes.TYPE+this.type)}if(!this.usingModal){if(!$(vtex.Messages.getInstance().placeholder)[0])throw new Error("Couldn't find placeholder for Message");if(this.template===this.classes.TEMPLATE)this.template=c,this.usingDefaultTemplate=!0;else{if(!$(this.template)[0])throw new Error("Couldn't find specified template for Message");this.usingDefaultTemplate=!1}this.domElement=$(this.template).clone(!1,!1),$(this.domElement).addClass(this.id+" "+this.classes.MESSAGEINSTANCE+" "+this.classes.TYPE+this.type)}$(this.domElement).data("vtex-message",this),this.content.html?(this.content.title&&""!==this.content.title?$(this.classes.TITLE,this.domElement).html(this.content.title):$(this.classes.TITLE,this.domElement).hide(),$(this.classes.DETAIL,this.domElement).html(this.content.detail)):(this.content.title&&""!==this.content.title?$(this.classes.TITLE,this.domElement).text(this.content.title):$(this.classes.TITLE,this.domElement).hide(),$(this.classes.DETAIL,this.domElement).text(this.content.detail)),this.content.title&&""!==this.content.title&&this.content.detail&&""!==this.content.detail||$(this.classes.SEPARATOR,this.domElement).hide()}return a.prototype.getTimeoutDefaults=function(a){var b,c;if(b=1e3,null!=a.timeout)c=a.timeout;else switch(this.type){case"success":c=10*b;break;case"info":c=15*b;break;case"warning":c=20*b;break;case"error":c=25*b;break;case"danger":c=30*b;break;default:c=30*b}return this.usingModal?0:c},a.prototype.startTimeout=function(){var a=this;return this.usingModal?void 0:(this.timer&&clearTimeout(this.timer),this.timer=window.setTimeout(function(){return a.hide()},this.timeout))},a.prototype.show=function(){var a,b=this;return this.usingModal&&(a=vtex.Messages.getInstance().modalQueue,-1===_.indexOf(a,this)&&($(this.domElement).one("hidden",function(){return b.hide(),a.splice(0,1),0!==a.length?$(a[0].domElement).modal("show"):void 0}),0===a.length&&$(this.domElement).modal("show"),-1===a.indexOf(this)&&a.push(this))),this.usingModal||(this.domElement.addClass("vtex-front-messages-template-opened"),null==this.timeout||0===this.timeout)?void 0:this.startTimeout()},a.prototype.hide=function(){var a=this;return this.usingModal&&$(window).trigger("removeMessage.vtex",this.id),this.usingModal?void 0:(this.domElement.removeClass("vtex-front-messages-template-opened"),"undefined"!=typeof Modernizr&&null!==Modernizr&&Modernizr.csstransforms&&Modernizr.csstransitions&&Modernizr.opacity?this.domElement.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){return a.domElement.hasClass("vtex-front-messages-template-opened")?void 0:$(window).trigger("removeMessage.vtex",a.id)}):$(window).trigger("removeMessage.vtex",this.id))},a}(),b=function(){function b(){}var c,e;return e=null,b.getInstance=function(a){return null==a&&(a={}),null!=e?e:e=new c(a)},c=function(){function b(a){var b;null==a&&(a={}),this.resetDuplicatedMessageTimeout=d(this.resetDuplicatedMessageTimeout,this),this.removeMessage=d(this.removeMessage,this),this.classes={PLACEHOLDER:".vtex-front-messages-placeholder",MODALPLACEHOLDER:"body"},b={ajaxError:!1,messagesArray:[],placeholder:this.classes.PLACEHOLDER,modalPlaceholder:this.classes.MODALPLACEHOLDER,modalQueue:[]},_.extend(this,b,a),this.buildPlaceholderTemplate(),this.registerEventListeners(),this.ajaxError&&this.bindAjaxError()}var c;return b.prototype.addMessage=function(b){var c;return c=new a(b),this.isMessageDuplicated(c)?0===c.timeout||c.usingModal?void 0:this.resetDuplicatedMessageTimeout(c):(this.messagesArray.push(c),c.usingModal?($(c.domElement).on("hidden",function(){return $(window).trigger("removeMessage.vtex",c.id)}),$(this.modalPlaceholder).append(c.domElement)):($(this.placeholder)[c.insertMethod](c.domElement),$(vtex.Messages.getInstance().placeholder).hasClass("vtex-front-messages-placeholder-opened")||$(vtex.Messages.getInstance().placeholder).addClass("vtex-front-messages-placeholder-opened")),c.show())},b.prototype.removeMessage=function(a){var b,c,d,e;for(c=d=e=this.messagesArray.length-1;d>=0;c=d+=-1)b=this.messagesArray[c],b.id===a&&(this.messagesArray.splice(c,1),b.usingModal?(b.domElement.modal("hide"),b.usingDefaultTemplate&&b.domElement.remove()):b.domElement.remove());return this.changeContainerVisibility()},b.prototype.resetDuplicatedMessageTimeout=function(a){return _.each(this.messagesArray,function(b){return b.content.title===a.content.title&&b.content.detail===a.content.detail&&b.usingModal===a.usingModal&&b.type===a.type?b.startTimeout():void 0})},b.prototype.isMessageDuplicated=function(a){var b;return b=!1,_.each(this.messagesArray,function(c){if(c.content.title===a.content.title&&c.content.detail===a.content.detail&&c.usingModal===a.usingModal&&c.type===a.type){if("vtex-front-message-"===a.id.substr(0,19))return b=!0;if(c.id!==a.id)return b=!1;if(c.id===a.id)return b=!0}}),b},b.prototype.removeAllMessages=function(a){var b,c,d,e;for(null==a&&(a=!1),b=d=e=this.messagesArray.length-1;d>=0;b=d+=-1)c=this.messagesArray[b],(c.usingModal===!1||a===!0)&&(c.domElement.remove(),this.messagesArray.splice(b,1));return this.changeContainerVisibility()},b.prototype.changeContainerVisibility=function(){var a;return a=_.filter(this.messagesArray,function(a){return a.usingModal===!1}),0===a.length&&$(vtex.Messages.getInstance().placeholder).hasClass("vtex-front-messages-placeholder-opened")?$(vtex.Messages.getInstance().placeholder).removeClass("vtex-front-messages-placeholder-opened"):void 0},b.prototype.bindAjaxError=function(){var a=this;return $(document).ajaxError(function(b,d){var e,f,g,h,i,j,k,l,m,n,o;if(401!==d.status&&403!==d.status&&0!==d.readyState&&0!==d.status)return i=window.i18n?window.i18n.t("global.unkownError"):"An unexpected error ocurred.",h=window.i18n?window.i18n.t("global.error"):"Error",g=window.i18n?window.i18n.t("global.close"):"Close",d.getResponseHeader("x-vtex-operation-id")&&(h+=' <small class="vtex-operation-id-container">(Operation ID ',h+='<span class="vtex-operation-id">',h+=decodeURIComponent(d.getResponseHeader("x-vtex-operation-id")),h+="</span>",h+=")</small>"),d.getResponseHeader("x-vtex-error-message")?(k=-1!==(null!=(n=d.getResponseHeader("Content-Type"))?n.indexOf("application/json"):void 0),k&&null!=(null!=(o=d.responseText.error)?o.message:void 0)?f=decodeURIComponent(d.responseText.error.message):(f=decodeURIComponent(d.getResponseHeader("x-vtex-error-message")),m="Value=1"===c("ShowFullError"),m&&(f+='<div class="vtex-error-detail-container">\n  <a href="javascript:void(0);" class="vtex-error-detail-link" onClick="$(\'.vtex-error-detail\').show()">\n    <small>Details</small>\n  </a>\n  <div class="vtex-error-detail" style="display: none;"></div>\n</div>',j=document.createElement("iframe"),j.src="data:text/html;charset=utf-8,"+decodeURIComponent(d.responseText),$(j).css("width","100%"),$(j).css("height","900px"),e=!0))):f=i,l={type:"fatal",content:{title:h,detail:f,html:!0},close:g},a.addMessage(l),e?($(".vtex-error-detail").html(j),e=null):void 0})},b.prototype.buildPlaceholderTemplate=function(){return $(".vtex-front-messages-placeholder").append('<button type="button" class="vtex-front-messages-close-all close">Ã—</button>')},b.prototype.registerEventListeners=function(){var a=this;return window?($(window).on("addMessage.vtex",function(b,c){return a.addMessage(c)}),$(window).on("removeMessage.vtex",function(b,c){return a.removeMessage(c)}),$(window).on("removeAllMessages.vtex",function(b,c){return null==c&&(c=!1),a.removeAllMessages(c)}),$(".vtex-front-messages-close-all").on("click",function(b,c){return null==c&&(c=!1),a.removeAllMessages(c)})):void 0},c=function(a){var b,c,d,e;if(c=null,document.cookie&&""!==document.cookie)for(d=document.cookie.split(";"),e=0;e<d.length;){if(b=(d[e]||"").replace(/^\s+|\s+$/g,""),b.substring(0,a.length+1)===a+"="){c=decodeURIComponent(b.substring(a.length+1));break}e++}return c},b}(),b}.call(this),c.vtex.Messages=b}).call(this);
//# sourceMappingURL=vtex-message.min.js.map