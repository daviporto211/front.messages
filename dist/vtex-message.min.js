/* front-messages-ui - v2.0.1 */
(function(){var Message,Messages,root,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};root="undefined"!=typeof exports&&null!==exports?exports:window,window.vtex=window.vtex||{},Message=function(){function Message(options){var defaultProperties,defaultTemplate,modalDefaultTemplate,_this=this;if(null==options&&(options={}),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.classes={TEMPLATEDEFAULT:".vtex-front-messages-template.vtex-front-messages-template-default",MODALTEMPLATEDEFAULT:".vtex-front-messages-template.vtex-front-messages-template-modal-default",TEMPLATE:".vtex-front-messages-container",TITLE:".vtex-front-messages-title",SEPARATOR:".vtex-front-messages-separator",DETAIL:".vtex-front-messages-detail",TYPE:"vtex-front-messages-type-",MESSAGEINSTANCE:"vtex-front-messages-instance"},defaultProperties={id:_.uniqueId("vtex-front-message-"),template:this.classes.TEMPLATE,timeout:0,modalTemplate:this.classes.MODALTEMPLATE,prefixClassForType:this.classes.TYPE,content:{title:"",detail:""},close:"Close",type:"info",visible:!1,usingModal:!1,domElement:$(),insertMethod:"append"},_.extend(this,defaultProperties,options),modalDefaultTemplate='<div class="vtex-front-messages-template vtex-front-messages-template-modal-default modal hide fade">\n  <div class="modal-header">\n    <h3 class="vtex-front-messages-title"></h3>\n  </div>\n  <div class="modal-body">\n    <p class="vtex-front-messages-detail"></p>\n  </div>\n  <div class="modal-footer">\n    <button class="btn" data-dismiss="modal" aria-hidden="true">'+this.close+"</button>\n  </div>\n</div>",defaultTemplate='<div class="vtex-front-messages-container">\n<div class="vtex-front-messages-template vtex-front-messages-template-default static-front-messages-template">\n  <span class="vtex-front-messages-title"></span><span class="vtex-front-messages-separator"> - </span><span 						class="vtex-front-messages-detail"></span>\n</div>\n</div>',"fatal"===this.type&&(this.usingModal=!0),this.usingModal){if(!$(vtex.Messages.getInstance().placeholder)[0])throw new Error("Couldn't find placeholder for modal Message");if(this.modalTemplate===this.classes.MODALTEMPLATE)this.modalTemplate=modalDefaultTemplate;else if(!$(this.modalTemplate)[0])throw new Error("Couldn't find specified template for modal Message");this.domElement=$(this.modalTemplate)}else{if(!$(vtex.Messages.getInstance().placeholder)[0])throw new Error("Couldn't find placeholder for Message");if(this.template===this.classes.TEMPLATE)this.template=defaultTemplate;else if(!$(this.template)[0])throw new Error("Couldn't find specified template for Message");this.domElement=$(this.template).clone(!1,!1),$(this.domElement).bind("closed",function(){return _this.visible=!1})}$(this.domElement).find(".vtex-front-messages-template").addClass(this.id+" "+this.classes.MESSAGEINSTANCE+" "+this.classes.TYPE+this.type),$(this.domElement).hide(),$(this.domElement).data("vtex-message",this),this.content.html?(this.content.title&&""!==this.content.title?$(this.classes.TITLE,this.domElement).html(this.content.title):($(this.classes.TITLE,this.domElement).hide(),$(this.classes.SEPARATOR,this.domElement).hide()),$(this.classes.DETAIL,this.domElement).html(this.content.detail)):(this.content.title&&""!==this.content.title?$(this.classes.TITLE,this.domElement).text(this.content.title):($(this.classes.TITLE,this.domElement).hide(),$(this.classes.SEPARATOR,this.domElement).hide()),$(this.classes.DETAIL,this.domElement).text(this.content.detail)),this.usingModal?($(this.domElement).on("hidden",function(){return _this.visible=!1}),$(vtex.Messages.getInstance().modalPlaceholder).append(this.domElement)):$(vtex.Messages.getInstance().placeholder)[this.insertMethod](this.domElement),this.visible&&this.show()}return Message.prototype.show=function(options){var eventName,flagVisibleSet,modal,modalData,userDone,_i,_j,_len,_len1,_ref,_ref1,_this=this;if(this.usingModal){if("object"==typeof options)for(_ref=["show","shown","hide","hidden"],_i=0,_len=_ref.length;_len>_i;_i++)eventName=_ref[_i],"function"==typeof options[eventName]&&!function(eventName){return $(_this.domElement).on(eventName,function(){return options[eventName](_this)})}(eventName);for(flagVisibleSet=!1,_ref1=$(".modal."+this.classes.MESSAGEINSTANCE),_j=0,_len1=_ref1.length;_len1>_j;_j++)modal=_ref1[_j],modalData=$(modal).data("vtex-message"),modalData.visible===!0&&modalData.domElement!==this.domElement[0]&&(flagVisibleSet=!0,$(modal).one("hidden",function(){return $(_this.domElement).modal("show"),_this.visible=!0}));return flagVisibleSet||($(this.domElement).on("show",function(){return _this.visible=!0}),$(this.domElement).modal("show")),void vtex.Messages.getInstance().changeContainerVisibility()}return"object"==typeof options&&null!=options.complete&&"function"==typeof options.complete?(userDone=options.complete,options.complete=function(){return _this.visible=!0,userDone(_this)},this.domElement.fadeIn(options)):"number"==typeof options?this.domElement.fadeIn(options,function(){return _this.visible=!0}):(this.domElement.show(),this.visible=!0,"object"==typeof options&&null!=options.timeout&&0!==options.timeout&&window.setTimeout(function(){return _this.hide(options)},options.timeout)),vtex.Messages.getInstance().changeContainerVisibility()},Message.prototype.hide=function(options){var userDone,_this=this;return this.usingModal?(this.domElement.modal("hide"),this.visible=!1,void vtex.Messages.getInstance().changeContainerVisibility()):("object"==typeof options&&null!=options.complete&&"function"==typeof options.complete?(userDone=options.complete,options.complete=function(){return _this.visible=!1,userDone(_this)},this.domElement.fadeOut(options)):"number"==typeof options?this.domElement.fadeOut(options,function(){return _this.visible=!1}):(this.domElement.hide(),this.visible=!1),vtex.Messages.getInstance().changeContainerVisibility())},Message}(),Messages=function(){function Messages(){}var VtexMessages,instance;return instance=null,Messages.getInstance=function(options){return null==options&&(options={}),null!=instance?instance:instance=new VtexMessages(options)},VtexMessages=function(){function VtexMessages(options){var defaultProperties;null==options&&(options={}),this.classes={PLACEHOLDER:".vtex-front-messages-placeholder",MODALPLACEHOLDER:"body"},defaultProperties={ajaxError:!1,messagesArray:[],placeholder:this.classes.PLACEHOLDER,modalPlaceholder:this.classes.MODALPLACEHOLDER},_.extend(this,defaultProperties,options),this.buildPlaceholderTemplate(),this.startEventListeners(),this.ajaxError&&this.bindAjaxError()}var getCookie;return VtexMessages.prototype.addMessage=function(message,show){var messageObj;return null==show&&(show=!1),messageObj=new Message(message),this.deduplicateMessages(messageObj),this.messagesArray.push(messageObj),show!==!1&&messageObj.show(message),messageObj.usingModal?void 0:$(vtex.Messages.getInstance().placeholder).show()},VtexMessages.prototype.removeMessage=function(messageProperty){var i,message,res,results,_i,_j,_len,_len1,_ref;for(results=_.where(this.messagesArray,messageProperty),_ref=this.messagesArray,i=_i=0,_len=_ref.length;_len>_i;i=++_i)for(message=_ref[i],_j=0,_len1=results.length;_len1>_j;_j++)if(res=results[_j],message.id===res.id)return message.domElement.remove(),void this.messagesArray.splice(i,1)},VtexMessages.prototype.deduplicateMessages=function(messageObj){return _.each(this.messagesArray,function(message){return message.content.title===messageObj.content.title&&message.content.detail===messageObj.content.detail&&message.usingModal===messageObj.usingModal&&message.type===messageObj.type?message.hide():void 0})},VtexMessages.prototype.hideAllMessages=function(usingModal){var _this=this;return _.each(this.messagesArray,function(message){return!message.visible||message.usingModal!==!1&&usingModal!==!0?void 0:(message.domElement.remove(),_this.messagesArray.splice(i,1))}),this.changeContainerVisibility()},VtexMessages.prototype.removeAllMessages=function(usingModal){var i,message,_i,_len,_ref;for(_ref=this.messagesArray,i=_i=0,_len=_ref.length;_len>_i;i=++_i)message=_ref[i],(message.usingModal===!1||usingModal===!0)&&(message.domElement.remove(),this.messagesArray.splice(i,1));this.changeContainerVisibility()},VtexMessages.prototype.changeContainerVisibility=function(){var hasMessages,notModalMessages;return notModalMessages=_.filter(this.messagesArray,function(message){return message.usingModal===!1}),hasMessages=_.find(notModalMessages,function(message){return message.visible===!0}),hasMessages?void 0:$(vtex.Messages.getInstance().placeholder).hide()},VtexMessages.prototype.bindAjaxError=function(){var _this=this;return $(document).ajaxError(function(event,xhr){var addIframeLater,errorMessage,globalClose,globalError,globalUnknownError,iframe,isContentJson,messageObj,showFullError,_ref,_ref1;if(401!==xhr.status&&403!==xhr.status&&0!==xhr.readyState&&0!==xhr.status)return window.i18n?(globalUnknownError=window.i18n.t("global.unkownError"),globalError=window.i18n.t("global.error"),globalClose=window.i18n.t("global.close")):(globalUnknownError="An unexpected error ocurred.",globalError="Error",globalClose="Close"),xhr.getResponseHeader("x-vtex-operation-id")&&(globalError+=' <small class="vtex-operation-id-container">(Operation ID ',globalError+='<span class="vtex-operation-id">',globalError+=decodeURIComponent(xhr.getResponseHeader("x-vtex-operation-id")),globalError+="</span>",globalError+=")</small>"),xhr.getResponseHeader("x-vtex-error-message")?(isContentJson=-1!==(null!=(_ref=xhr.getResponseHeader("Content-Type"))?_ref.indexOf("application/json"):void 0),isContentJson&&null!=(null!=(_ref1=xhr.responseText.error)?_ref1.message:void 0)?errorMessage=decodeURIComponent(xhr.responseText.error.message):(errorMessage=decodeURIComponent(xhr.getResponseHeader("x-vtex-error-message")),showFullError="Value=1"===getCookie("ShowFullError"),showFullError&&(errorMessage+='<div class="vtex-error-detail-container">\n  <a href="javascript:void(0);" class="vtex-error-detail-link" onClick="$(\'.vtex-error-detail\').show()">\n    <small>Details</small>\n  </a>\n  <div class="vtex-error-detail" style="display: none;"></div>\n</div>',iframe=document.createElement("iframe"),iframe.src="data:text/html;charset=utf-8,"+decodeURIComponent(xhr.responseText),$(iframe).css("width","100%"),$(iframe).css("height","900px"),addIframeLater=!0))):errorMessage=globalUnknownError,messageObj={type:"fatal",content:{title:globalError,detail:errorMessage,html:!0},close:globalClose},_this.addMessage(messageObj,!0),addIframeLater?($(".vtex-error-detail").html(iframe),addIframeLater=null):void 0})},VtexMessages.prototype.buildPlaceholderTemplate=function(){return $(".vtex-front-messages-placeholder").append('<button type="button" class="vtex-front-messages-close-all close">×</button>')},VtexMessages.prototype.startEventListeners=function(){var _this=this;return window?($(window).on("addMessage.vtex",function(evt,message,show){return _this.addMessage(message,null!=show?show:!0)}),$(window).on("clearMessages.vtex",function(evt,usingModal){return null==usingModal&&(usingModal=!1),_this.removeAllMessages(usingModal)}),$(".vtex-front-messages-close-all").on("click",function(evt,usingModal){return null==usingModal&&(usingModal=!1),_this.hideAllMessages(usingModal)})):void 0},getCookie=function(name){var cookie,cookieValue,cookies,i;if(cookieValue=null,document.cookie&&""!==document.cookie)for(cookies=document.cookie.split(";"),i=0;i<cookies.length;){if(cookie=(cookies[i]||"").replace(/^\s+|\s+$/g,""),cookie.substring(0,name.length+1)===name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}i++}return cookieValue},VtexMessages}(),Messages}(),root.vtex.Messages=Messages}).call(this);