/* front-messages-ui - v2.0.4 */
(function(){var Message,Messages,root,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};root="undefined"!=typeof exports&&null!==exports?exports:window,window.vtex=window.vtex||{},Message=function(){function Message(options){var defaultProperties,defaultTemplate,modalDefaultTemplate,_this=this;if(null==options&&(options={}),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.classes={TEMPLATEDEFAULT:".vtex-front-messages-template.vtex-front-messages-template-default",MODALTEMPLATEDEFAULT:".vtex-front-messages-modal-template.vtex-front-messages-modal-template-default",TEMPLATE:".vtex-front-messages-template",TITLE:".vtex-front-messages-title",SEPARATOR:".vtex-front-messages-separator",DETAIL:".vtex-front-messages-detail",TYPE:"vtex-front-messages-type-",MESSAGEINSTANCE:"vtex-front-messages-instance"},defaultProperties={id:_.uniqueId("vtex-front-message-"),timeout:3e4,template:this.classes.TEMPLATE,modalTemplate:this.classes.MODALTEMPLATE,prefixClassForType:this.classes.TYPE,content:{title:"",detail:""},close:"Close",type:"info",visible:!0,usingModal:!1,domElement:$(),insertMethod:"append"},_.extend(this,defaultProperties,options),this.timeout=this.setTimeoutDefaults(options),modalDefaultTemplate='<div class="vtex-front-messages-modal-template vtex-front-messages-modal-template-default modal hide fade">\n  <div class="modal-header">\n    <h3 class="vtex-front-messages-title"></h3>\n  </div>\n  <div class="modal-body">\n    <p class="vtex-front-messages-detail"></p>\n  </div>\n  <div class="modal-footer">\n    <button class="btn" data-dismiss="modal" aria-hidden="true">'+this.close+"</button>\n  </div>\n</div>",defaultTemplate='<div class="vtex-front-messages-template">\n  <span class="vtex-front-messages-title"></span><span class="vtex-front-messages-separator"> - </span><span 						class="vtex-front-messages-detail"></span>\n</div>',"fatal"===this.type&&(this.usingModal=!0),this.usingModal){if(!$(vtex.Messages.getInstance().modalPlaceholder)[0])throw new Error("Couldn't find placeholder for Modal Message");if(this.modalTemplate===this.classes.MODALTEMPLATE)this.modalTemplate=modalDefaultTemplate;else if(!$(this.modalTemplate)[0])throw new Error("Couldn't find specified template for Modal Message");this.domElement=$(this.modalTemplate),$(this.domElement).addClass(this.id+" "+this.classes.MESSAGEINSTANCE+" "+this.classes.TYPE+this.type).hide()}if(!this.usingModal){if(!$(vtex.Messages.getInstance().placeholder)[0])throw new Error("Couldn't find placeholder for Message");if(this.template===this.classes.TEMPLATE)this.template=defaultTemplate;else if(!$(this.template)[0])throw new Error("Couldn't find specified template for Message");this.domElement=$(this.template).clone(!1,!1),$(this.domElement).addClass(this.id+" "+this.classes.MESSAGEINSTANCE+" "+this.classes.TYPE+this.type)}$(this.domElement).data("vtex-message",this),this.content.html?(this.content.title&&""!==this.content.title?$(this.classes.TITLE,this.domElement).html(this.content.title):$(this.classes.TITLE,this.domElement).hide(),$(this.classes.DETAIL,this.domElement).html(this.content.detail)):(this.content.title&&""!==this.content.title?$(this.classes.TITLE,this.domElement).text(this.content.title):$(this.classes.TITLE,this.domElement).hide(),$(this.classes.DETAIL,this.domElement).text(this.content.detail)),this.content.title&&""!==this.content.title&&this.content.detail&&""!==this.content.detail||$(this.classes.SEPARATOR,this.domElement).hide(),this.usingModal?($(this.domElement).on("hidden",function(){return _this.visible=!1,$(window).trigger("removeMessage.vtex",_this.id)}),$(vtex.Messages.getInstance().modalPlaceholder).append(this.domElement)):$(vtex.Messages.getInstance().placeholder)[this.insertMethod](this.domElement),this.show()}return Message.prototype.setTimeoutDefaults=function(options){var ONE_SECOND,timeout;if(ONE_SECOND=1e3,null!=options.timeout)timeout=options.timeout;else switch(this.type){case"success":timeout=10*ONE_SECOND;break;case"info":timeout=15*ONE_SECOND;break;case"warning":timeout=20*ONE_SECOND;break;case"error":timeout=25*ONE_SECOND;break;case"danger":timeout=30*ONE_SECOND;break;default:timeout=30*ONE_SECOND}return timeout},Message.prototype.show=function(){var flagVisibleSet,modal,modalData,_i,_len,_ref,_this=this;if(this.usingModal){for(flagVisibleSet=!1,_ref=$(".modal."+this.classes.MESSAGEINSTANCE),_i=0,_len=_ref.length;_len>_i;_i++)modal=_ref[_i],modalData=$(modal).data("vtex-message"),modalData.domElement[0]!==this.domElement[0]&&modalData.visible===!0&&(flagVisibleSet=!0,$(modal).one("hidden",function(){return $(_this.domElement).modal("show"),_this.visible=!0}));flagVisibleSet||($(this.domElement).on("show",function(){return _this.visible=!0}),$(this.domElement).modal("show"))}return this.usingModal||(this.domElement.addClass("vtex-front-messages-template-opened"),this.visible=!0,null==this.timeout||0===this.timeout)?void 0:window.setTimeout(function(){return _this.hide()},this.timeout)},Message.prototype.hide=function(){var _this=this;return this.usingModal&&(this.domElement.modal("hide"),$(window).trigger("removeMessage.vtex",this.id)),this.usingModal?void 0:(this.domElement.removeClass("vtex-front-messages-template-opened"),"undefined"!=typeof Modernizr&&null!==Modernizr&&Modernizr.csstransforms&&Modernizr.csstransitions&&Modernizr.opacity?this.domElement.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){return _this.domElement.hasClass("vtex-front-messages-template-opened")?void 0:$(window).trigger("removeMessage.vtex",_this.id)}):$(window).trigger("removeMessage.vtex",this.id))},Message}(),Messages=function(){function Messages(){}var VtexMessages,instance;return instance=null,Messages.getInstance=function(options){return null==options&&(options={}),null!=instance?instance:instance=new VtexMessages(options)},VtexMessages=function(){function VtexMessages(options){var defaultProperties;null==options&&(options={}),this.removeMessage=__bind(this.removeMessage,this),this.classes={PLACEHOLDER:".vtex-front-messages-placeholder",MODALPLACEHOLDER:"body"},defaultProperties={ajaxError:!1,messagesArray:[],placeholder:this.classes.PLACEHOLDER,modalPlaceholder:this.classes.MODALPLACEHOLDER},_.extend(this,defaultProperties,options),this.buildPlaceholderTemplate(),this.registerEventListeners(),this.ajaxError&&this.bindAjaxError()}var getCookie;return VtexMessages.prototype.addMessage=function(message){var messageObj;return messageObj=new Message(message),this.deduplicateMessages(messageObj),this.messagesArray.push(messageObj),messageObj.show(),messageObj.usingModal||$(vtex.Messages.getInstance().placeholder).hasClass("vtex-front-messages-placeholder-opened")?void 0:$(vtex.Messages.getInstance().placeholder).addClass("vtex-front-messages-placeholder-opened")},VtexMessages.prototype.removeMessage=function(messageId){var currentMessage,i,_i,_ref;for(i=_i=_ref=this.messagesArray.length-1;_i>=0;i=_i+=-1)currentMessage=this.messagesArray[i],currentMessage.id===messageId&&(this.messagesArray.splice(i,1),currentMessage.usingModal?currentMessage.domElement.modal("hide"):currentMessage.domElement.remove());return this.changeContainerVisibility()},VtexMessages.prototype.deduplicateMessages=function(messageObj){return _.each(this.messagesArray,function(message){return message.content.title===messageObj.content.title&&message.content.detail===messageObj.content.detail&&message.usingModal===messageObj.usingModal&&message.type===messageObj.type?message.hide():void 0})},VtexMessages.prototype.removeAllMessages=function(usingModal){var i,message,_i,_ref;for(null==usingModal&&(usingModal=!1),i=_i=_ref=this.messagesArray.length-1;_i>=0;i=_i+=-1)message=this.messagesArray[i],(message.usingModal===!1||usingModal===!0)&&(message.domElement.remove(),this.messagesArray.splice(i,1));return this.changeContainerVisibility()},VtexMessages.prototype.changeContainerVisibility=function(){var notModalMessages;return notModalMessages=_.filter(this.messagesArray,function(message){return message.usingModal===!1}),0===notModalMessages.length&&$(vtex.Messages.getInstance().placeholder).hasClass("vtex-front-messages-placeholder-opened")?$(vtex.Messages.getInstance().placeholder).removeClass("vtex-front-messages-placeholder-opened"):void 0},VtexMessages.prototype.bindAjaxError=function(){var _this=this;return $(document).ajaxError(function(event,xhr){var addIframeLater,errorMessage,globalClose,globalError,globalUnknownError,iframe,isContentJson,messageObj,showFullError,_ref,_ref1;if(401!==xhr.status&&403!==xhr.status&&0!==xhr.readyState&&0!==xhr.status)return globalUnknownError=window.i18n?window.i18n.t("global.unkownError"):"An unexpected error ocurred.",globalError=window.i18n?window.i18n.t("global.error"):"Error",globalClose=window.i18n?window.i18n.t("global.close"):"Close",xhr.getResponseHeader("x-vtex-operation-id")&&(globalError+=' <small class="vtex-operation-id-container">(Operation ID ',globalError+='<span class="vtex-operation-id">',globalError+=decodeURIComponent(xhr.getResponseHeader("x-vtex-operation-id")),globalError+="</span>",globalError+=")</small>"),xhr.getResponseHeader("x-vtex-error-message")?(isContentJson=-1!==(null!=(_ref=xhr.getResponseHeader("Content-Type"))?_ref.indexOf("application/json"):void 0),isContentJson&&null!=(null!=(_ref1=xhr.responseText.error)?_ref1.message:void 0)?errorMessage=decodeURIComponent(xhr.responseText.error.message):(errorMessage=decodeURIComponent(xhr.getResponseHeader("x-vtex-error-message")),showFullError="Value=1"===getCookie("ShowFullError"),showFullError&&(errorMessage+='<div class="vtex-error-detail-container">\n  <a href="javascript:void(0);" class="vtex-error-detail-link" onClick="$(\'.vtex-error-detail\').show()">\n    <small>Details</small>\n  </a>\n  <div class="vtex-error-detail" style="display: none;"></div>\n</div>',iframe=document.createElement("iframe"),iframe.src="data:text/html;charset=utf-8,"+decodeURIComponent(xhr.responseText),$(iframe).css("width","100%"),$(iframe).css("height","900px"),addIframeLater=!0))):errorMessage=globalUnknownError,messageObj={type:"fatal",content:{title:globalError,detail:errorMessage,html:!0},close:globalClose},_this.addMessage(messageObj),addIframeLater?($(".vtex-error-detail").html(iframe),addIframeLater=null):void 0})},VtexMessages.prototype.buildPlaceholderTemplate=function(){return $(".vtex-front-messages-placeholder").append('<button type="button" class="vtex-front-messages-close-all close">×</button>')},VtexMessages.prototype.registerEventListeners=function(){var _this=this;return window?($(window).on("addMessage.vtex",function(evt,message){return _this.addMessage(message)}),$(window).on("removeMessage.vtex",function(evt,messageId){return _this.removeMessage(messageId)}),$(window).on("removeAllMessages.vtex",function(evt,usingModal){return null==usingModal&&(usingModal=!1),_this.removeAllMessages(usingModal)}),$(".vtex-front-messages-close-all").on("click",function(evt,usingModal){return null==usingModal&&(usingModal=!1),_this.removeAllMessages(usingModal)})):void 0},getCookie=function(name){var cookie,cookieValue,cookies,i;if(cookieValue=null,document.cookie&&""!==document.cookie)for(cookies=document.cookie.split(";"),i=0;i<cookies.length;){if(cookie=(cookies[i]||"").replace(/^\s+|\s+$/g,""),cookie.substring(0,name.length+1)===name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}i++}return cookieValue},VtexMessages}(),Messages}.call(this),root.vtex.Messages=Messages}).call(this);